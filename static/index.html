<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<canvas width="170" height="230" style="border: 1px solid black"></canvas>

<script>
    let baseUrl = '/';


    let canvas = document.querySelector("canvas");
    let ctx = canvas.getContext("2d");
    var position, target;

    function redraw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)

        if(position) {
            ctx.beginPath();
            ctx.arc(position[0], position[1], 5, 0, 2 * Math.PI);
            ctx.stroke();
        }

        if(target) {
            ctx.beginPath();
            ctx.arc(target[0], target[1], 5, 0, 2 * Math.PI);
            ctx.fill()
            ctx.stroke();
        }
    }

    canvas.onclick = () => {
        var rect = canvas.getBoundingClientRect();
        var x = event.clientX - rect.left;
        var y = event.clientY - rect.top;

        let xhr = new XMLHttpRequest()
        xhr.open('PUT', `${baseUrl}api/set_target`, true);
        xhr.onload = () => {
            console.log(xhr.responseText)
        }
        xhr.send(JSON.stringify({
           X: x,
           Y: y
        }))
    }

    var source = new EventSource(`${baseUrl}events/measurements`);
    source.addEventListener('measurement', (event) => {
        let data = JSON.parse(event.data);

        position = [data['POSX'], data['POSY']]
        redraw()
    })

    source.addEventListener('target_position', (event) => {
        let data = JSON.parse(event.data);

        target = [data['X'], data['Y']]
        redraw()
    });
</script>

</body>
</html>